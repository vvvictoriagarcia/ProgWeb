<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Noticias Espaciales – Asincronismo</title>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

  <style>
    body{
      font-family: Arial, sans-serif;
      background:#f2f2f2;
      padding:20px;
      color:#222;
    }

    h1{
      text-align:center;
      margin-bottom:20px;
    }

    #estado{
      text-align:center;
      font-size:14px;
      margin-bottom:10px;
      font-style:italic;
      color:#555;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(260px,1fr));
      gap:20px;
      max-width:1200px;
      margin:0 auto;
    }

    .card{
      background:white;
      border-radius:12px;
      box-shadow:0 0 10px rgba(0,0,0,.12);
      padding:14px;
    }

    .card img{
      width:100%;
      border-radius:10px;
      margin-bottom:10px;
    }

    .card h3{
      font-size:17px;
      margin-bottom:6px;
    }

    .card p{
      font-size:14px;
      line-height:1.5;
      margin-bottom:10px;
    }

    .fecha{
      font-size:12px;
      color:#666;
      margin-bottom:6px;
    }

    .btn{
      display:block;
      margin:20px auto;
      padding:10px 18px;
      background:#2962ff;
      border:none;
      border-radius:6px;
      color:white;
      font-size:14px;
      cursor:pointer;
    }

    .btn:hover{
      background:#0039cb;
    }

    .error{
      text-align:center;
      color:#b00020;
      font-weight:bold;
      margin-top:12px;
    }
  </style>
</head>

<body>

  <h1>Noticias Espaciales (API pública)</h1>

  <div id="estado">Cargando noticias...</div>

  <div class="grid" id="contenedor"></div>

  <p id="error" class="error" style="display:none;"></p>

  <button class="btn" id="btn-mas">Cargar más noticias</button>

<script>
  // API v4 (funcional) – endpoint correcto
  const API_URL = "https://api.spaceflightnewsapi.net/v4/articles";
  const contenedor = document.getElementById("contenedor");
  const estado = document.getElementById("estado");
  const errorEl = document.getElementById("error");

  let page = 1;     // v4 usa page / page_size
  const pageSize = 6;

  async function cargarNoticias(){
    try{
      estado.textContent = "Cargando noticias...";
      errorEl.style.display = "none";

      const r = await axios.get(`${API_URL}?page=${page}&page_size=${pageSize}`, {timeout:5000});
      const datos = r.data;

      const noticias = datos.results;
      if(!Array.isArray(noticias) || noticias.length === 0){
        estado.textContent = "No hay más noticias disponibles.";
        return;
      }

      noticias.forEach(nota => {
        const card = document.createElement("div");
        card.className = "card";

        // algunos artículos pueden no tener imagen, entonces fallback
        const imgUrl = nota.image_url || "https://via.placeholder.com/600x400?text=Sin+imagen";

        const fecha = new Date(nota.published_at).toLocaleString();

        card.innerHTML = `
          <img src="${imgUrl}" alt="${nota.title}">
          <h3>${nota.title}</h3>
          <div class="fecha">${fecha}</div>
          <p>${nota.summary ? nota.summary.slice(0,140) + "..." : "Artículo sin resumen disponible."}</p>
          <a href="${nota.url}" target="_blank">Leer más</a>
        `;

        contenedor.appendChild(card);
      });

      estado.textContent = `Mostrando página ${page}`;
      page++;

    } catch(e){
      console.error("Error al cargar noticias:", e);
      errorEl.textContent = "No se pudieron obtener las noticias.";
      errorEl.style.display = "block";
      estado.textContent = "";
    }
  }

  document.getElementById("btn-mas").addEventListener("click", cargarNoticias);

  // Primera carga
  cargarNoticias();
</script>

</body>
</html>
